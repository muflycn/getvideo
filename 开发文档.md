# GetVideo - 视频下载应用

## 项目概述
基于 yt-dlp 的视频/音频/图片下载应用，提供网页界面和API接口，支持Docker部署到1panel。

## 技术栈
- 前端：Next.js 14 + TypeScript + Tailwind CSS
- 后端：Node.js + Express
- 下载引擎：yt-dlp
- 部署：Docker + 1panel

## 功能特性
1. 网页界面：用户友好的下载界面
2. API接口：支持n8n、coze等平台集成
3. 多格式支持：视频、音频、图片
4. 进度监控：实时下载进度显示
5. 批量下载：支持多个链接同时处理

## 项目结构
```
getvideo/
├── src/
│   ├── app/
│   │   ├── api/
│   │   │   ├── download/
│   │   │   ├── status/
│   │   │   └── health/
│   │   ├── page.tsx
│   │   └── layout.tsx
│   ├── components/
│   │   ├── DownloadForm.tsx
│   │   ├── ProgressBar.tsx
│   │   └── FileList.tsx
│   └── lib/
│       ├── ytdlp.ts
│       └── utils.ts
├── public/
├── downloads/
├── Dockerfile
├── docker-compose.yml
├── package.json
├── next.config.js
├── tailwind.config.ts
└── tsconfig.json
```

## API 接口设计

### 1. 下载接口
- **POST /api/download**
- 参数：
  ```json
  {
    "url": "视频链接",
    "format": "video|audio|thumbnail",
    "quality": "best|worst|720p|480p等"
  }
  ```

### 2. 状态查询
- **GET /api/status/:taskId**
- 返回下载进度和状态

### 3. 健康检查
- **GET /api/health**
- 系统状态检查

## Docker 部署配置
- 基于 Node.js Alpine 镜像
- 预装 yt-dlp 和依赖
- 支持数据卷挂载
- 环境变量配置

## 1Panel 部署说明
1. 上传 docker-compose.yml
2. 配置环境变量
3. 映射下载目录
4. 启动服务

## 项目上下文分析

### 现有项目状态
- **工作空间**: f:\codes\Qode\getvideo (空目录，仅有.qoder配置)
- **技术环境**: Windows 23H2, PowerShell, Qoder IDE 0.2.1
- **目标技术栈**: 需要确定前后端技术栈

### yt-dlp项目分析
基于对yt-dlp项目的调研，了解到：
- **核心功能**: 支持数千个网站的音视频下载
- **支持格式**: 视频、音频、缩略图等多种格式
- **命令行工具**: Python编写，支持丰富的命令行参数
- **平台支持**: 跨平台，Windows/Linux/MacOS
- **许可证**: Unlicense (开源)

## 原始需求分析

### 用户需求描述
1. 基于yt-dlp开发一个项目
2. 用户提供链接，选择下载视频/音频/图片
3. 网页端界面呈现
4. 提供API接口
5. 支持n8n、coze等平台的插件集成

### 用户偏好记忆对齐
- **API集成偏好**: 用户偏好通过提供API接口的方式，将功能以插件形式集成到n8n、coze等自动化平台
- **权限管理**: 需要考虑用户权限和文档权限转移功能

## 需求理解确认

### 功能需求
1. **核心下载功能**
   - 支持视频下载（多种格式和质量）
   - 支持音频提取下载
   - 支持图片/缩略图下载
   - 支持批量下载

2. **Web界面需求**
   - 用户友好的链接输入界面
   - 格式选择器（视频/音频/图片）
   - 质量选择器
   - 下载进度显示
   - 下载历史记录

3. **API接口需求**
   - RESTful API设计
   - 支持同步/异步下载
   - 进度查询接口
   - 下载状态管理
   - 错误处理和状态码

4. **第三方平台集成**
   - n8n节点集成
   - coze插件支持
   - 标准化API文档

### 技术约束
- 需要Python环境（yt-dlp依赖）
- 需要ffmpeg支持（音视频处理）
- 跨平台兼容性要求
- 安全性考虑（文件存储、API访问控制）

## 边界确认

### 项目范围内
- Web前端界面开发
- 后端API服务开发
- yt-dlp集成和封装
- 基础的用户管理
- API文档和示例
- 第三方平台集成指南

### 项目范围外
- 复杂的用户权限系统
- 大规模集群部署
- 商业化功能
- 高级视频编辑功能

## 疑问澄清

### 需要决策的关键问题

1. **技术栈选择**
   - 前端框架：React + Next.js vs Vue.js vs 原生HTML
   - 后端框架：Node.js + Express vs Python Flask/FastAPI vs Go
   - 数据库：SQLite vs PostgreSQL vs MongoDB

2. **部署方式**
   - 本地部署 vs 云端部署
   - Docker容器化 vs 传统部署
   - 单机版 vs 分布式架构

3. **存储策略**
   - 本地文件存储 vs 云存储
   - 临时文件清理策略
   - 下载文件的生命周期管理

4. **安全考虑**
   - API访问控制（API Key vs JWT vs OAuth）
   - 文件访问权限
   - 下载速率限制

5. **用户体验**
   - 实时下载进度 vs 后台任务
   - 下载完成通知方式
   - 错误处理和用户反馈

### 基于现有项目和行业知识的智能决策

**技术栈推荐**：
- 前端：Next.js (React) - 支持SSR，SEO友好，API路由集成
- 后端：Node.js + Express - 与前端统一语言，便于维护
- 数据库：SQLite - 轻量级，适合个人/小团队使用
- 容器化：Docker - 简化部署和依赖管理

**架构设计**：
- 前后端分离但集成在同一个Next.js项目中
- 使用子进程调用yt-dlp命令行工具
- WebSocket实现实时进度更新
- 任务队列处理下载请求

**存储策略**：
- 本地文件存储，支持配置存储路径
- 定时清理临时文件
- 提供下载链接的临时访问

**安全方案**：
- API Key认证机制
- 请求频率限制
- 文件访问权限控制